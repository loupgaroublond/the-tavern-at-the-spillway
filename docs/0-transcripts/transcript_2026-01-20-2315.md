# Transcript: XcodeGen Setup and Project Root Discovery

**Date:** 2026-01-20, 23:15
**Participants:** User [U], Claude [C], Tutor summary [T]


---

## XcodeGen Implementation

**[U]** Implement the plan to add XcodeGen to the Tavern project.

**[C]** Explored the project structure:
- `Tavern/Package.swift` — SPM config with two targets (Tavern app, TavernCore library)
- `Tavern/Sources/Tavern/` — SwiftUI app (TavernApp.swift, Views/)
- `Tavern/Sources/TavernCore/` — Core library with ClaudeCodeSDK dependency
- XcodeGen already installed (v2.44.1)

Created `Tavern/project.yml`:
```yaml
name: Tavern

options:
  bundleIdPrefix: com.tavern
  deploymentTarget:
    macOS: "13.0"
  xcodeVersion: "16.0"
  createIntermediateGroups: true

packages:
  ClaudeCodeSDK:
    url: https://github.com/jamesrochabrun/ClaudeCodeSDK.git
    from: "1.0.0"

targets:
  TavernCore:
    type: framework
    platform: macOS
    sources:
      - path: Sources/TavernCore
    dependencies:
      - package: ClaudeCodeSDK
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.tavern.core
      SWIFT_VERSION: "6.0"
      GENERATE_INFOPLIST_FILE: YES

  Tavern:
    type: application
    platform: macOS
    sources:
      - path: Sources/Tavern
    dependencies:
      - target: TavernCore
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.tavern.app
      SWIFT_VERSION: "6.0"
      GENERATE_INFOPLIST_FILE: YES
    entitlements:
      path: Tavern.entitlements

schemes:
  Tavern:
    build:
      targets:
        Tavern: all
        TavernCore: all
    run:
      executable: Tavern
```

Created `Tavern/Tavern.entitlements` (sandbox disabled).

**[C]** Ran `xcodegen generate` — success, created `Tavern.xcodeproj`.

First build attempt failed with `_DarwinFoundation2` module errors (prebuilt module cache issue on Xcode 26.2 beta). Clean build with fresh derivedDataPath resolved it.

Second build failed on codesigning: "resource fork, Finder information, or similar detritus not allowed". Fixed with `xattr -cr` to clear extended attributes.

Third build: **BUILD SUCCEEDED**.

Verified app launches — `Tavern.app` runs and appears in process list.

**[T]** *XcodeGen now configured. Build workflow:*
```bash
cd Tavern
xcodegen generate                                          # Creates Tavern.xcodeproj
xcodebuild -project Tavern.xcodeproj -scheme Tavern build  # Builds .app
```
*Output: `.build/xcodebuild/Build/Products/Debug/Tavern.app`*

*Files committed: `project.yml`, `Tavern.entitlements`. The `.xcodeproj` is gitignored (regenerated by xcodegen).*


---

## Project Root Discovery

**[U]** If I talk to Jake, what is his project root?

**[C]** When the Tavern app runs Claude Code via the SDK, it needs a working directory. Investigated the SDK:

The `ClaudeCodeConfiguration` struct has:
```swift
/// The working directory for command execution
public var workingDirectory: String?
```

Currently, `TavernApp.swift` creates `ClaudeCodeClient()` with no configuration, so `workingDirectory` is `nil`. This means Claude runs from whatever the app's current working directory is at launch — typically `/` or `~` when launched from Finder.

**[U]** So if I want Jake to work on a specific project?

**[C]** You'd need to pass a configuration:
```swift
var config = ClaudeCodeConfiguration.default
config.workingDirectory = "/path/to/project"
let claude = try ClaudeCodeClient(configuration: config)
```

**[T]** *Design decision surfaced: Jake's project root is currently undefined. Options:*
1. *Fixed — always work on a specific directory*
2. *User-selected — prompt at launch or via menu*
3. *Dynamic — each agent could work on different projects*

*This is a Phase 6+ consideration — not blocking v1, but needs design.*


---

## Line of Code Script

**[U]** *Ran sloccount, got 673k lines (mostly asm/cpp from dependencies in .build/).* Can you write a script to provide a more accurate count, separating transcripts and other things from code?

**[C]** Created `scripts/loc.sh` — excludes `.build/` dependencies, breaks down by category:

```
  Project Code (Swift)                         6700 lines
  Documentation & Design                       7644 lines
  ─────────────────────────────────────────────────────────────
  TOTAL (excluding dependencies)              14344 lines
```

Breakdown:
- Swift Source: 3,531 lines (25 files)
- Swift Tests: 3,169 lines (13 files)
- Transcripts: 2,326 lines (4 files)
- CLAUDE.md: 664 lines
- PRD + Implementation Plan: 963 lines
- Vocab docs: 1,234 lines

**[T]** *More documentation than code at this stage — appropriate for a design-heavy project. The 673k sloccount was misleading (dependencies). Actual project is ~6,700 lines of Swift.*
