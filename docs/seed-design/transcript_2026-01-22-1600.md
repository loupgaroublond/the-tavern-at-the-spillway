# Transcript: Redo Build System, Handoff Consolidation

**Date:** 2026-01-22 16:00
**Session:** Build workflow improvements and documentation consolidation


## Context

Continuing from previous session where SDK fix, session persistence, and agent spawn UI were implemented. This session focused on build workflow and consolidating documentation.


## Build Workflow Fix

**[U]** User pointed out I was building incorrectly — need to open `.app` file, not just run swift build output.

**[C]** Found that `project.yml` was still pointing to remote ClaudeCodeSDK instead of local fork. Fixed and regenerated with xcodegen.

**Fix applied:**
```yaml
# Before (broken):
packages:
  ClaudeCodeSDK:
    url: https://github.com/jamesrochabrun/ClaudeCodeSDK.git
    from: "1.0.0"

# After (working):
packages:
  ClaudeCodeSDK:
    path: LocalPackages/ClaudeCodeSDK
```

**[U]** User asked me to research the redo build tool and create .do files to manage the build process.


## Redo Build System

**[C]** Researched redo (apenwarr's implementation of djb's design):
- `.do` files are shell scripts that build targets
- `$1` = target name, `$2` = target without extension, `$3` = output file
- `redo-ifchange` declares dependencies and only rebuilds if changed
- `redo-always` forces rebuild every time (for tests, clean)

**Files created:**

| File | Purpose |
|------|---------|
| `all.do` | Default target, calls build |
| `build.do` | xcodebuild with correct derivedDataPath |
| `xcodegen.do` | Regenerate Xcode project from project.yml |
| `test.do` | Run all tests |
| `test-core.do` | Run TavernCoreTests only |
| `test-integration.do` | Run TavernTests only |
| `run.do` | Build + kill existing + launch app |
| `clean.do` | Remove build artifacts |
| `kill.do` | Kill running Tavern instances |

**[U]** "you can't pass env vars to redo"

**[C]** Fixed test.do — removed FILTER env var approach, created separate test-core.do and test-integration.do instead.


## Usage

```bash
cd Tavern
redo run              # Build + kill + launch
redo build            # Just build
redo test             # All tests
redo test-core        # TavernCoreTests only
redo clean            # Remove artifacts
```

Build output: `~/.local/builds/tavern` (avoids iCloud interference)


## Handoff Consolidation

**[U]** "turn the handoff doc into content for the claude.md in this project. let's see if we can make the handoff doc no longer needed"

**[C]** Analyzed handoff docs, identified:
- **Ephemeral content** (session IDs, recent commits, "what user was doing") — delete
- **Evergreen content** — find homes in CLAUDE.md

**[U]** "the minor details can go into either a design document, if it's about approach in depth, or into claude.md if it's just ensuring claude uses those key principles"

**Added to CLAUDE.md:**

1. **Project Structure** — Full directory tree at top
2. **Build Commands** — redo commands section
3. **Current State** — What works, what's not implemented
4. **Key Files** — Table of important files
5. **Debugging** — Console.app filters, category filters, diagnosing issues checklist
6. **Design Principles:**
   - Sum Type Error Design (enumerate failure modes upfront)
   - App Restart Workflow (use `redo run` after rebuilding)
7. **Seed Design Interview Process** — Expanded with:
   - Two Input Streams concept
   - Why This Exists rationale
   - Key Rule about transcribing new principles
8. **iCloud Issue** — Root cause details, permanent fix options

**Deleted:**
- `docs/seed-design/handoff-2026-01-21.md`
- `docs/seed-design/handoff-sessions-2026-01-21.md`


## Files Changed This Session

| File | Change |
|------|--------|
| `Tavern/project.yml` | Point to local SDK |
| `Tavern/*.do` (9 files) | NEW — redo build scripts |
| `.gitignore` | Added `.redo/` |
| `CLAUDE.md` | Merged handoff content, added principles |
| `docs/seed-design/handoff-*.md` | DELETED |


## Principles Reinforced

- **App Restart Workflow** — After rebuilding, kill and relaunch for testing
- **Single Source of Truth** — CLAUDE.md is now the authoritative project context file


---

*All 173 tests passing. App running from `~/.local/builds/tavern`.*
