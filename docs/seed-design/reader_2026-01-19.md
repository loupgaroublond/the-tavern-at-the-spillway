# The Tavern at the Spillway — System Design Reader

**Date:** 2026-01-19

**Purpose:** This document synthesizes discovery session transcripts into a standalone explanation of the system design. Read this instead of tailing transcripts.


---

## 1. Executive Summary

The Tavern at the Spillway is a multi-agent orchestration framework with a custom user interface. The system manages a swarm of AI agents working on development tasks, with a coordinating "daemon" agent (Jake) that spawns and manages "mortal" task-specific agents.

The core value proposition is solving the attention management problem: when using one AI agent, there is idle time; when using many, the human cannot track them all. This framework provides a dashboard and chat interface that surfaces the right agent conversations at the right time, allowing users to engage productively with multiple agents without being overwhelmed by notifications or missing critical questions.

The system is built on the Claude Agent SDK (not wrapping Claude Code's TUI) and will ship as a macOS application with a GUI-less framework core for other interfaces.


---

## 2. Problem Statement

These pain points drove the design (from transcript_1026, 10:26):

**Attention Management:**
- One Claude Code instance means waiting around with low efficiency
- Multiple instances require tracking all of them while engaging with any single one
- More than 5 sessions becomes impossible to manage while also doing focused work
- Permission requests from background agents interrupt focused conversations

**Tooling Gaps:**
- YOLO mode needs a sandbox; the built-in one does not fit; third-party tools make incorrect assumptions about git and worktrees
- IDE integration is janky in the terminal; VSCode plugin has different issues
- No good tool to balance jumping into code yourself vs letting the agent work
- Terminal-based TUIs are hard to manage; everyone settles on tmux-based solutions

**Coordination Problems:**
- Agents run free-for-all; fixes turn into complex pipelines
- Too many agents clobber each other when working on the same things
- Worktree management tools make gross assumptions about repo usage

**Workflow Rigidity:**
- Many workflows require deterministic shells to enforce correct execution; hooks constrain without flexibility
- Many frameworks do not manage "efficiency of quality" and allow agents to burn too many tokens
- Frameworks either have rigid workflows or no workflows at all

**Visibility Gaps:**
- No self-improvement of these systems
- Not enough telemetry to improve; heavy reliance on brute force
- TUI Claude Code smooshes everything together (thinking, tool use, coding, chat) making it unreadable


---

## 3. Core Concepts

### Jake (The Proprietor)

Jake is the top-level coordinating daemon agent. He is always running and manages the entire system. Key characteristics:

- **Daemon lifecycle:** Jake never dies; mortal agents are task-bound
- **Lowest privileges by quantity:** Jake has few direct capabilities but highest authority to spawn and manage other agents
- **First contact:** For a fresh project, the user's first interaction is with Jake
- **Task delegation:** Jake quickly fires up mortal agents to handle work, staying free for the next request

Jake has a distinctive voice (used car salesman energy, carnival barker theatrics), but this is presentation layer only. The work is flawless.


### Mortal Agents

Agents spawned by Jake to complete specific tasks. Their lifecycle is bound to task completion.

**Task Modes** (agents can bounce between these):
- Execute directly
- Delegate to a new child agent
- Plan more first
- Break into pieces and assign
- Unify work from delegated children

Mortal agents can have children, forming a tree structure per user request.


### Perseverance Mode vs Chat Mode

Two operating modes for agents:

**Perseverance Mode:** Background operation. When the agent stops, the system auto-prompts it to continue. The agent must explicitly use a tool to get user attention. This is the default for agents working heads-down.

**Chat Mode:** Active conversation. The agent appears in a chat window; the user is notified when the agent pauses or stops. Used when user is actively engaged with that agent.

The user controls which mode each agent is in. Zooming in on an agent brings it to chat mode; "hanging up" returns it to perseverance mode.


### Bubbling

When child agents need user input, they can escalate questions upward through the agent hierarchy. Bubbling is not strictly upward:

- **Upward:** child to parent to grandparent to user
- **Lateral:** sibling agents communicating
- **Direct:** agent to user (with oversight by other agents)

Jake is especially proactive about suggesting the user zoom into specific agents when their attention is needed.


### Agent Naming

Jake assigns each mortal agent tree a naming theme (LOTR characters, Rick and Morty, Santa's reindeer, Docker-style compound names). This gives users intuitive sense of agent relationships — agents with similar names are from the same task tree.

**Unique names:** Every mortal agent gets a globally unique name across the entire system. This means you can identify any agent by name alone — no path addressing (like "Jake/Donner/Blitzen") is required for identity. However, path-style addressing may still be useful for messaging later.

**Tier depletion:** Themes can have escalating tiers of silliness (e.g., first tier is "Donner, Blitzen, Prancer"; second tier is "Donner 2: The Dominator"). The purpose of tiers is to exhaust less silly names before breaking out sillier ones — it's a depletion mechanism, not just a hierarchy.


---

## 4. User Flow

This section describes how a user interacts with the system (from transcript_1144, 10:40):

### Starting a Fresh Project

1. User opens project directory in the UI
2. For a project with no history, they see only Jake's chat box
3. User describes what they need
4. Jake fires up a mortal agent to handle it
5. Jake remains free for additional requests

### Working with Agents

- Each task appears as both a todo item AND a chat interface
- Dashboard shows all open tasks; user can drill into any agent chat
- User sees tabs/UX for agents they are actively engaged with
- Notification bubbles appear when agents have questions
- User plays "whack-a-mole" jumping between conversations as needed

### Zooming In and Out

When user wants to focus on a specific agent:

- System creates a chat box for that agent
- If agent is busy, user sees "cogitating" status while responses stream
- User can steer the agent, interrupt it, or wait
- Agent receives a "calling" message when user zooms in
- Agent receives "hanging up" message when user zooms out

Zoom decisions include: is this chat ephemeral, kept open, or a todo list candidate?

### Dashboard and Oversight

- Task list can surface subtrees based on user's preferred oversight level
- Some agents may be heads down and busy (do not appear in chat interface)
- Jake is always aware of: hibernating agents, unfinished work, backlogs
- User can jump in anywhere they want
- System surfaces high-quality interactions while sparing tedious approvals

### Completing Work

- Mortal agents expire or go into hibernation when tasks complete
- Jake ensures someone handles open loops
- Dashboard reflects completed vs in-progress vs pending work


---

## 5. Architecture Notes

### Tech Stack

- **Agent runtime:** Claude Agent SDK (not TUI wrapper)
- **Low-level layer:** Likely Swift (unless strong reason for TypeScript or Python)
- **GUI:** Swift/SwiftUI (macOS primary target)
- **Alternative interfaces:** GUI-less framework core, TUI equivalent

### Why Not Wrap Claude Code TUI

- TUI is not conducive to programmatic control
- Requires hooks when we could just send messages directly
- Cannot easily separate different content streams
- The "smooshed together" display problem is inherent to the TUI approach

### Agent Hierarchy

```
Jake (daemon)
 └── Mortal Agent A (task-bound)
      ├── Child Agent A1
      ├── Child Agent A2
      │    └── Grandchild Agent A2a
      └── Child Agent A3
 └── Mortal Agent B (task-bound)
      └── ...
```

### Communication Patterns

- Agents can communicate upward (to parents), laterally (to siblings), or directly to user
- Messages bubble up through hierarchy unless agent has permission for direct contact
- Parent agents provide oversight for child-to-user communication
- Jake coordinates across all task trees

### Session Management

- Perseverance mode: system sends continuation prompts
- Chat mode: user is in the loop for every pause
- Special messages: "calling" (user zooms in), "hanging up" (user zooms out)
- Agent state machine designed on top of SDK primitives


---

## 6. Open Questions

These questions were flagged during discovery for later resolution. Each includes context for why it matters.


### ?1 — Worktree/Git Assumptions

What assumptions do existing tools make that are incorrect for this use case? Understanding this shapes the entire isolation/sandbox architecture.

**Context:** User noted third-party tools and YOLO sandboxing make assumptions about git and worktrees that do not work for their repos.


### ?2 — Deterministic Shell Meaning

What does "deterministic shell" mean concretely? Possibilities include: scripted steps in order with validation gates, reproducibility requirements, audit trails, or something else.

**Context:** User needs more than hooks — possibly a full workflow DSL or state machine.


### ?3 — Self Improvement Definition

What does "self improvement" mean? Options range from better logging to ML-based prompt optimization to evolutionary workflow design.

**Context:** Listed as a pain point that existing frameworks lack.


### ?4 — Agent "Done" Assertion

How do we know when a mortal agent's task is complete? Is it self-declared, parent-verified, or user-confirmed? What about wrong/incomplete work, partial completion, or "done enough"?

**Context:** This is the lifecycle boundary for mortal agents. Getting it wrong means zombie agents or premature termination.


### ?5 — Bubbling Up Process

Exactly how does bubbling work? Does child ask parent who decides to escalate? Can messages skip levels? Is there prioritization?

**Context:** This is the core attention-routing mechanism.


### ?6 — Perseverance Prompts and Agent Lifecycle

What exactly is a perseverance prompt? What are the lifecycle states of an agent? What triggers transitions?

**Context:** This defines the async agent runtime state machine.


### ?7 — User Consent for New Chats

What does "100% clear they're OK with it" mean concretely? User preference settings? Contextual inference? Per-agent consent?

**Context:** User controls attention; agents suggest but do not force.


### ?8 — Sandboxing for Safety

What permissions model? What isolation mechanism? How do we avoid the git/worktree assumptions? What is the trust hierarchy?

**Context:** User wants autonomous agents AND safety. These goals are in tension.


### ?9 — UI Stream Separation

How do we separate thinking, tool use, coding, running jobs, and chat? One view with visual distinction, or separate panes? Collapsible?

**Context:** The TUI smooshing problem is a core pain point to solve.


---

## 7. Vocabulary Decisions

### Cogitation Verbs

The system uses "cogitation verbs" to describe agent processing states (displayed while agent is working). The vocabulary draws from Jewish cultural and linguistic traditions.

**Scope (711 entries):** Yiddish, Hebrew, Ladino, Judeo-Arabic, Talmudic Aramaic, Kabbalistic terminology, and terms from diaspora communities including Ethiopian, Yemeni, Bukharan, Mountain Jews, Karaite, and modern denominational movements.

**Inclusion criterion:** Groups that claim Jewish identity are included regardless of how disputed. Groups that differentiate themselves from Judaism (like Rastafarians, who claim Israelite rather than Jewish identity) are excluded.

**Usage:** Terms appear in natural forms; awkward -ing constructions are avoided (e.g., "farblondzhet" not "farblondzhet-ing").

See `vocab_cogitation-verbs_2026-01-19-1144.md` for the full list.


### Agent Naming Themes

Jake assigns naming themes to agent trees. Documented themes include:

- LOTR characters
- Rick and Morty
- Santa's reindeer (with escalating tier silliness)
- Docker-style compound names
- Jewish figures

See `vocab_naming-themes_2026-01-19-1144.md` for details.


### Terminology Note

Technical documentation uses plain names (perseverance mode, mortal agents, bubbling). Jake's colorful vocabulary (Slop Squad, Multi-Slop Madness, the Jukebox) is presentation layer only and does not appear in architecture or design documents.


---

## 8. Conversation Chronicle

This section provides a chronological index of when topics were discussed. Use it to trace back to original discussions.


### Session 1 — Process Establishment (09:06)

**File:** `transcript_2026-01-19-0906.md`

| Time | Topic | Notes |
|------|-------|-------|
| 09:06 | Process meta-setup | Two input sources established: verbal + initial_notes.md |
| 09:14 | Documentation location | docs/seed-design/ folder, datetime suffixes |
| 09:14 | Session continuity | User directs start, I figure out what to read |
| 09:19 | Transcript format | Notation system: [U], [C], [T], [S] tags |
| 09:24 | Format corrections | Proper list formatting, tag styling |
| 09:29 | Ready to start | Process established, ready for the idea |


### Session 1 — Problem Statement (10:26)

**File:** `transcript_2026-01-19-1026.md`

| Time | Topic | Notes |
|------|-------|-------|
| 10:26 | 14 pain points listed | Attention, tooling, coordination, workflow, visibility |
| 10:31 | Framework-level concerns | 9 additional potential issues to plan for |
| 10:31 | Open questions system | [?] notation, verbose context requirement |
| 10:31 | Notes for amnesia | Process lesson: write for reader with zero memory |


### Session 1 — User Flow (10:40 - 12:00)

**File:** `transcript_2026-01-19-1144.md`

| Time | Topic | Notes |
|------|-------|-------|
| 10:40 | Core user flow | Jake as entry point, mortal agent spawning |
| 10:40 | 5 task modes | Execute, delegate, plan, break up, unify |
| 10:40 | ?4 pinned | Agent "done" assertion |
| 10:40 | Bubbling concept | Child agents escalate questions upward |
| 10:40 | ?5 pinned | Bubbling process details |
| 10:40 | Perseverance vs chat mode | Background vs active conversation |
| 10:40 | Zoom mechanics | Calling, hanging up, cogitating status |
| 10:40 | ?6 pinned | Perseverance prompts, agent lifecycle |
| 10:40 | User consent | Agents suggest, do not force |
| 10:40 | ?7 pinned | User consent for new chats |
| 10:40 | Platform decision | Mac app primary, GUI-less core, TUI equivalent |
| 10:40 | ?8 pinned | Sandboxing for safety |
| 10:40 | Jake's privileges | Least privileges by quantity, highest authority |
| 10:40 | Agent naming themes | LOTR, Rick & Morty, reindeer, Docker-style |
| 10:40 | Cogitation verbs intro | Jewish cultural vocabulary request |
| 11:57 | Implications confirmed | Tree structure, zoom richness, bubbling patterns |
| 11:57 | Tech stack | Claude Agent SDK, Swift/SwiftUI |
| 11:57 | ?9 pinned | UI stream separation |
| 11:59 | Terminology decision | Plain names for components, not character names |


### Session 1 — Vocabulary Expansion (12:00 - 12:30)

**File:** `transcript_2026-01-19-1144.md`

| Time | Topic | Notes |
|------|-------|-------|
| 12:00 | Ladino, Judeo-Arabic, esoteric terms | Expanding beyond Yiddish |
| 12:00 | Provenance policy | Terms must be backed by documented Jewish texts |
| 12:30 | Judeo-Persian, Judeo-Italian restored | Proper attestation added |
| 12:30 | Beta Israel, Romaniote, Mountain Jews | Ethiopian, Greek, Caucasus |
| 12:30 | Bukharan, Indian, Georgian Jews | Central Asia, subcontinent |
| 12:30 | Karaite Jews | Those following only written Torah |
| 12:30 | Modern denominational | Reform, Conservative, Reconstructionist |
| 12:30 | Rastafarians excluded | Claim Israelite, not Jewish, identity |
| 12:30 | Jewish Renewal, Second Temple, Secular Israeli | Added |
| 12:30 | Khazars, Donmeh, Falash Mura | Historical and crypto-Jewish groups |
| 12:30 | Inclusion criterion finalized | Claim Jewish identity = include |
| 12:30 | Final count | 711 entries across global Jewish diaspora |


### Session 2 — Clarifications (later on 01-19)

**File:** This session (not yet in transcript)

| Time | Topic | Notes |
|------|-------|-------|
| — | Agent naming: unique names | Every mortal agent has globally unique name, no path addressing needed for identity |
| — | Agent naming: tier depletion | Tiers exhaust less silly names before breaking out sillier ones |
| — | Path addressing | May still be useful for messaging, but not required for identity |
| — | File consistency principle | When updating one file, update all related files (code, config, docs) to prevent tech debt |


### Key Decision Points

For quick reference, major decisions and their locations:

| Decision | Location | Summary |
|----------|----------|---------|
| Jake as daemon | transcript_1144, 10:40 | Always running, spawns mortal agents |
| Perseverance mode | transcript_1144, 10:40 | Auto-continue, no user notification |
| Chat mode | transcript_1144, 10:40 | Active conversation, user notified |
| Bubbling is multi-directional | transcript_1144, 11:57 | Upward, lateral, and direct-to-user |
| Tech stack: Swift/SwiftUI | transcript_1144, 11:57 | Mac primary, SDK not TUI wrapper |
| Plain names for components | transcript_1144, 11:59 | Character names are Jake's voice only |
| Vocabulary provenance | transcript_1144, 12:00 | Documented Jewish texts required |
| Inclusion criterion | transcript_1144, 12:30 | Claims Jewish identity = included |
| Agent names globally unique | Session 2 | No path addressing needed for identity |
| Tier depletion for naming | Session 2 | Exhaust less silly before sillier |
| File consistency | Session 2 | Update all related files (code, config, docs) together to prevent tech debt |


---

## Source Files

| File | Purpose |
|------|---------|
| `transcript_2026-01-19-0906.md` | Process establishment |
| `transcript_2026-01-19-1026.md` | Problem statement, pain points |
| `transcript_2026-01-19-1144.md` | User flow, architecture, vocabulary |
| `process_2026-01-19-0906.md` | Open questions, meta-process |
| `vocab_cogitation-verbs_2026-01-19-1144.md` | 711 cogitation verbs |
| `vocab_naming-themes_2026-01-19-1144.md` | Agent naming themes |
| `notes_issues-to-plan-for_2026-01-19-1031.md` | Framework-level concerns |
